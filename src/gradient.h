#include <cmath>
#include <vector>

struct Color {
    float r, g, b;
    Color() : r(0), g(0), b(0) {}
    Color(float r, float g, float b) : r(r), g(g), b(b) {}
    Color(float s) : r(s), g(s), b(s) {}
    ~Color() {}
};

Color linear2srgb(const Color& c) {
    return Color(
        c.r <= 0.0031308f ? 12.92f * c.r : 1.055f * std::pow(c.r, 1.0f / 2.4f) - 0.055f,
        c.g <= 0.0031308f ? 12.92f * c.g : 1.055f * std::pow(c.g, 1.0f / 2.4f) - 0.055f,
        c.b <= 0.0031308f ? 12.92f * c.b : 1.055f * std::pow(c.b, 1.0f / 2.4f) - 0.055f
    );
}

Color srgb2linear(const Color& c) {
    return Color(
        c.r <= 0.04045f ? c.r / 12.92f : std::pow((c.r + 0.055f) / 1.055f, 2.4f),
        c.g <= 0.04045f ? c.g / 12.92f : std::pow((c.g + 0.055f) / 1.055f, 2.4f),
        c.b <= 0.04045f ? c.b / 12.92f : std::pow((c.b + 0.055f) / 1.055f, 2.4f)
    );
}

class Gradient {
    public:
    std::vector<Color> colors;
    std::vector<float> positions; // 0 to 1
    Gradient() {
        // Default gradient: black to white
        colors.push_back(Color(0.0f));
        colors.push_back(Color(1.0f));
        positions.push_back(0.0f);
        positions.push_back(1.0f);
    }   
    Gradient(const std::vector<Color>& colors, const std::vector<float>& positions) : colors(colors), positions(positions) {}
    ~Gradient() {}
    Color get_color(float t) const {
        if (t <= positions.front()) return colors.front();
        if (t >= positions.back()) return colors.back();
        for (size_t i = 0; i < positions.size() - 1; ++i) {
            if (t >= positions[i] && t <= positions[i + 1]) {
                float local_t = (t - positions[i]) / (positions[i + 1] - positions[i]);
                return linear2srgb(Color(
                    colors[i].r + local_t * (colors[i + 1].r - colors[i].r),
                    colors[i].g + local_t * (colors[i + 1].g - colors[i].g),
                    colors[i].b + local_t * (colors[i + 1].b - colors[i].b)
                ));
            }
        }
        return Color(1.f, 0.f, 1.f); // Should never reach here
    }
};

Gradient YlGnBu() {
    std::vector<Color> colors = {
        Color(1.00000, 1.00000, 0.85098),
        Color(0.99779, 0.99914, 0.84606),
        Color(0.99557, 0.99828, 0.84114),
        Color(0.99336, 0.99742, 0.83622),
        Color(0.99114, 0.99656, 0.83130),
        Color(0.98893, 0.99569, 0.82637),
        Color(0.98671, 0.99483, 0.82145),
        Color(0.98450, 0.99397, 0.81653),
        Color(0.98228, 0.99311, 0.81161),
        Color(0.98007, 0.99225, 0.80669),
        Color(0.97785, 0.99139, 0.80177),
        Color(0.97564, 0.99053, 0.79685),
        Color(0.97343, 0.98967, 0.79193),
        Color(0.97121, 0.98880, 0.78700),
        Color(0.96900, 0.98794, 0.78208),
        Color(0.96678, 0.98708, 0.77716),
        Color(0.96457, 0.98622, 0.77224),
        Color(0.96235, 0.98536, 0.76732),
        Color(0.96014, 0.98450, 0.76240),
        Color(0.95792, 0.98364, 0.75748),
        Color(0.95571, 0.98278, 0.75256),
        Color(0.95349, 0.98191, 0.74764),
        Color(0.95128, 0.98105, 0.74271),
        Color(0.94907, 0.98019, 0.73779),
        Color(0.94685, 0.97933, 0.73287),
        Color(0.94464, 0.97847, 0.72795),
        Color(0.94242, 0.97761, 0.72303),
        Color(0.94021, 0.97675, 0.71811),
        Color(0.93799, 0.97589, 0.71319),
        Color(0.93578, 0.97502, 0.70827),
        Color(0.93356, 0.97416, 0.70334),
        Color(0.93135, 0.97330, 0.69842),
        Color(0.92883, 0.97232, 0.69416),
        Color(0.92415, 0.97047, 0.69453),
        Color(0.91948, 0.96863, 0.69490),
        Color(0.91480, 0.96678, 0.69527),
        Color(0.91013, 0.96494, 0.69564),
        Color(0.90545, 0.96309, 0.69601),
        Color(0.90078, 0.96125, 0.69638),
        Color(0.89610, 0.95940, 0.69675),
        Color(0.89143, 0.95755, 0.69712),
        Color(0.88675, 0.95571, 0.69749),
        Color(0.88208, 0.95386, 0.69785),
        Color(0.87740, 0.95202, 0.69822),
        Color(0.87273, 0.95017, 0.69859),
        Color(0.86805, 0.94833, 0.69896),
        Color(0.86338, 0.94648, 0.69933),
        Color(0.85870, 0.94464, 0.69970),
        Color(0.85403, 0.94279, 0.70007),
        Color(0.84935, 0.94095, 0.70044),
        Color(0.84468, 0.93910, 0.70081),
        Color(0.84000, 0.93725, 0.70118),
        Color(0.83532, 0.93541, 0.70155),
        Color(0.83065, 0.93356, 0.70191),
        Color(0.82597, 0.93172, 0.70228),
        Color(0.82130, 0.92987, 0.70265),
        Color(0.81662, 0.92803, 0.70302),
        Color(0.81195, 0.92618, 0.70339),
        Color(0.80727, 0.92434, 0.70376),
        Color(0.80260, 0.92249, 0.70413),
        Color(0.79792, 0.92065, 0.70450),
        Color(0.79325, 0.91880, 0.70487),
        Color(0.78857, 0.91696, 0.70524),
        Color(0.78390, 0.91511, 0.70561),
        Color(0.77818, 0.91286, 0.70610),
        Color(0.76932, 0.90942, 0.70696),
        Color(0.76046, 0.90597, 0.70782),
        Color(0.75160, 0.90253, 0.70868),
        Color(0.74275, 0.89908, 0.70954),
        Color(0.73389, 0.89564, 0.71040),
        Color(0.72503, 0.89220, 0.71126),
        Color(0.71617, 0.88875, 0.71213),
        Color(0.70731, 0.88531, 0.71299),
        Color(0.69845, 0.88186, 0.71385),
        Color(0.68960, 0.87842, 0.71471),
        Color(0.68074, 0.87497, 0.71557),
        Color(0.67188, 0.87153, 0.71643),
        Color(0.66302, 0.86808, 0.71729),
        Color(0.65416, 0.86464, 0.71815),
        Color(0.64531, 0.86119, 0.71902),
        Color(0.63645, 0.85775, 0.71988),
        Color(0.62759, 0.85430, 0.72074),
        Color(0.61873, 0.85086, 0.72160),
        Color(0.60987, 0.84741, 0.72246),
        Color(0.60101, 0.84397, 0.72332),
        Color(0.59216, 0.84052, 0.72418),
        Color(0.58330, 0.83708, 0.72504),
        Color(0.57444, 0.83363, 0.72591),
        Color(0.56558, 0.83019, 0.72677),
        Color(0.55672, 0.82674, 0.72763),
        Color(0.54787, 0.82330, 0.72849),
        Color(0.53901, 0.81985, 0.72935),
        Color(0.53015, 0.81641, 0.73021),
        Color(0.52129, 0.81296, 0.73107),
        Color(0.51243, 0.80952, 0.73193),
        Color(0.50358, 0.80607, 0.73280),
        Color(0.49518, 0.80286, 0.73375),
        Color(0.48755, 0.80003, 0.73486),
        Color(0.47992, 0.79720, 0.73596),
        Color(0.47230, 0.79437, 0.73707),
        Color(0.46467, 0.79154, 0.73818),
        Color(0.45704, 0.78871, 0.73928),
        Color(0.44941, 0.78588, 0.74039),
        Color(0.44178, 0.78305, 0.74150),
        Color(0.43416, 0.78022, 0.74261),
        Color(0.42653, 0.77739, 0.74371),
        Color(0.41890, 0.77456, 0.74482),
        Color(0.41127, 0.77173, 0.74593),
        Color(0.40364, 0.76890, 0.74704),
        Color(0.39602, 0.76607, 0.74814),
        Color(0.38839, 0.76324, 0.74925),
        Color(0.38076, 0.76042, 0.75036),
        Color(0.37313, 0.75759, 0.75146),
        Color(0.36551, 0.75476, 0.75257),
        Color(0.35788, 0.75193, 0.75368),
        Color(0.35025, 0.74910, 0.75479),
        Color(0.34262, 0.74627, 0.75589),
        Color(0.33499, 0.74344, 0.75700),
        Color(0.32737, 0.74061, 0.75811),
        Color(0.31974, 0.73778, 0.75922),
        Color(0.31211, 0.73495, 0.76032),
        Color(0.30448, 0.73212, 0.76143),
        Color(0.29686, 0.72929, 0.76254),
        Color(0.28923, 0.72646, 0.76364),
        Color(0.28160, 0.72363, 0.76475),
        Color(0.27397, 0.72080, 0.76586),
        Color(0.26634, 0.71797, 0.76697),
        Color(0.25872, 0.71514, 0.76807),
        Color(0.25269, 0.71145, 0.76838),
        Color(0.24826, 0.70690, 0.76789),
        Color(0.24383, 0.70235, 0.76740),
        Color(0.23940, 0.69779, 0.76691),
        Color(0.23497, 0.69324, 0.76641),
        Color(0.23054, 0.68869, 0.76592),
        Color(0.22611, 0.68414, 0.76543),
        Color(0.22168, 0.67958, 0.76494),
        Color(0.21725, 0.67503, 0.76444),
        Color(0.21283, 0.67048, 0.76395),
        Color(0.20840, 0.66593, 0.76346),
        Color(0.20397, 0.66138, 0.76297),
        Color(0.19954, 0.65682, 0.76248),
        Color(0.19511, 0.65227, 0.76198),
        Color(0.19068, 0.64772, 0.76149),
        Color(0.18625, 0.64317, 0.76100),
        Color(0.18182, 0.63862, 0.76051),
        Color(0.17739, 0.63406, 0.76002),
        Color(0.17296, 0.62951, 0.75952),
        Color(0.16854, 0.62496, 0.75903),
        Color(0.16411, 0.62041, 0.75854),
        Color(0.15968, 0.61586, 0.75805),
        Color(0.15525, 0.61130, 0.75755),
        Color(0.15082, 0.60675, 0.75706),
        Color(0.14639, 0.60220, 0.75657),
        Color(0.14196, 0.59765, 0.75608),
        Color(0.13753, 0.59309, 0.75559),
        Color(0.13310, 0.58854, 0.75509),
        Color(0.12867, 0.58399, 0.75460),
        Color(0.12424, 0.57944, 0.75411),
        Color(0.11982, 0.57489, 0.75362),
        Color(0.11539, 0.57033, 0.75313),
        Color(0.11411, 0.56471, 0.75110),
        Color(0.11473, 0.55843, 0.74814),
        Color(0.11534, 0.55216, 0.74519),
        Color(0.11596, 0.54588, 0.74224),
        Color(0.11657, 0.53961, 0.73928),
        Color(0.11719, 0.53333, 0.73633),
        Color(0.11780, 0.52706, 0.73338),
        Color(0.11842, 0.52078, 0.73043),
        Color(0.11903, 0.51451, 0.72747),
        Color(0.11965, 0.50824, 0.72452),
        Color(0.12026, 0.50196, 0.72157),
        Color(0.12088, 0.49569, 0.71862),
        Color(0.12149, 0.48941, 0.71566),
        Color(0.12211, 0.48314, 0.71271),
        Color(0.12272, 0.47686, 0.70976),
        Color(0.12334, 0.47059, 0.70681),
        Color(0.12395, 0.46431, 0.70385),
        Color(0.12457, 0.45804, 0.70090),
        Color(0.12518, 0.45176, 0.69795),
        Color(0.12580, 0.44549, 0.69499),
        Color(0.12641, 0.43922, 0.69204),
        Color(0.12703, 0.43294, 0.68909),
        Color(0.12764, 0.42667, 0.68614),
        Color(0.12826, 0.42039, 0.68318),
        Color(0.12887, 0.41412, 0.68023),
        Color(0.12949, 0.40784, 0.67728),
        Color(0.13010, 0.40157, 0.67433),
        Color(0.13072, 0.39529, 0.67137),
        Color(0.13133, 0.38902, 0.66842),
        Color(0.13195, 0.38275, 0.66547),
        Color(0.13256, 0.37647, 0.66251),
        Color(0.13318, 0.37020, 0.65956),
        Color(0.13361, 0.36475, 0.65698),
        Color(0.13398, 0.35958, 0.65452),
        Color(0.13435, 0.35442, 0.65206),
        Color(0.13472, 0.34925, 0.64960),
        Color(0.13509, 0.34408, 0.64714),
        Color(0.13546, 0.33892, 0.64468),
        Color(0.13582, 0.33375, 0.64221),
        Color(0.13619, 0.32858, 0.63975),
        Color(0.13656, 0.32341, 0.63729),
        Color(0.13693, 0.31825, 0.63483),
        Color(0.13730, 0.31308, 0.63237),
        Color(0.13767, 0.30791, 0.62991),
        Color(0.13804, 0.30275, 0.62745),
        Color(0.13841, 0.29758, 0.62499),
        Color(0.13878, 0.29241, 0.62253),
        Color(0.13915, 0.28724, 0.62007),
        Color(0.13952, 0.28208, 0.61761),
        Color(0.13988, 0.27691, 0.61515),
        Color(0.14025, 0.27174, 0.61269),
        Color(0.14062, 0.26657, 0.61023),
        Color(0.14099, 0.26141, 0.60777),
        Color(0.14136, 0.25624, 0.60531),
        Color(0.14173, 0.25107, 0.60285),
        Color(0.14210, 0.24591, 0.60038),
        Color(0.14247, 0.24074, 0.59792),
        Color(0.14284, 0.23557, 0.59546),
        Color(0.14321, 0.23040, 0.59300),
        Color(0.14358, 0.22524, 0.59054),
        Color(0.14394, 0.22007, 0.58808),
        Color(0.14431, 0.21490, 0.58562),
        Color(0.14468, 0.20973, 0.58316),
        Color(0.14505, 0.20457, 0.58070),
        Color(0.14198, 0.20145, 0.57393),
        Color(0.13841, 0.19862, 0.56655),
        Color(0.13484, 0.19579, 0.55917),
        Color(0.13127, 0.19296, 0.55179),
        Color(0.12770, 0.19013, 0.54441),
        Color(0.12414, 0.18730, 0.53702),
        Color(0.12057, 0.18447, 0.52964),
        Color(0.11700, 0.18164, 0.52226),
        Color(0.11343, 0.17881, 0.51488),
        Color(0.10987, 0.17598, 0.50750),
        Color(0.10630, 0.17315, 0.50012),
        Color(0.10273, 0.17032, 0.49273),
        Color(0.09916, 0.16749, 0.48535),
        Color(0.09559, 0.16466, 0.47797),
        Color(0.09203, 0.16183, 0.47059),
        Color(0.08846, 0.15900, 0.46321),
        Color(0.08489, 0.15617, 0.45582),
        Color(0.08132, 0.15334, 0.44844),
        Color(0.07775, 0.15051, 0.44106),
        Color(0.07419, 0.14768, 0.43368),
        Color(0.07062, 0.14485, 0.42630),
        Color(0.06705, 0.14202, 0.41892),
        Color(0.06348, 0.13919, 0.41153),
        Color(0.05992, 0.13636, 0.40415),
        Color(0.05635, 0.13353, 0.39677),
        Color(0.05278, 0.13070, 0.38939),
        Color(0.04921, 0.12787, 0.38201),
        Color(0.04564, 0.12504, 0.37463),
        Color(0.04208, 0.12221, 0.36724),
        Color(0.03851, 0.11938, 0.35986),
        Color(0.03494, 0.11656, 0.35248),
        Color(0.03137, 0.11373, 0.34510)
    };
    std::vector<float> positions = std::vector<float>(colors.size());
    for (size_t i = 0; i < colors.size(); ++i) {
        positions[i] = static_cast<float>(i) / (colors.size() - 1);
    }
    return Gradient(colors, positions);
}